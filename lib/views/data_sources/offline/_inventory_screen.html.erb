<% packages = Package.active.select { |p| Inventory.directly_collected_types.any? { |t| p.inventoried_by_type?(t, screen) } }
   types = Inventory.directly_collected_types.select { |t| packages.any? { |p| p.inventoried_by_type?(t, screen) } } -%>
    <p class="note"><%= h(t("visits.nr_instructions")) %></p>

    <table class="inventory spreadsheet">
      <thead>
        <tr>
          <th><%= h(t("visits.health_center_inventory.#{screen}.product_header")) %></th>
          <th><%= h(t("visits.health_center_inventory.ideal_quantity")) %></th>
          <%- types.each do |t| -%>
            <th><%= h(t("visits.health_center_inventory.#{t}")) %></th>
          <%- end -%>
        </tr>
      </thead>
      <tbody>
        <%- packages.sort.each do |package| -%>
          <tr>
            <th><%= h package.label %></th>
            <td class="numeric">
              <span class="output ideal_stock-health_center-<%= package.code %>"></span>
            </td>
            <%- types.each do |type|
                  id = "inventory_#{package.code}_#{type}" -%>
              <td>
                <%- if package.inventoried_by_type?(type, screen) -%>
                  <div class="tally">
                    <!--xf:alert><%= h(t("data_sources.hcvisit.errors.quantity")) %></xf:alert-->
                    <%- if Inventory.nullable_types.include?(type) -%>
                      <input required_unless_nr="<%= id %>-nr" type="text" id="<%= id %>-qty" name="<%= id %>-qty" />
                      <div class="nr">
                        <input type="checkbox" id="<%= id %>-nr" name="<%= id %>-nr" />
                        <label for="<%= id %>-nr"><%= h(t("NR")) %></label>
                      </div>
                    <%- else -%>
                      <input required type="text" id="<%= id %>-qty" name="<%= id %>-qty" />
                    <%- end -%>
                  </div>
                <%- end -%>
              </td>
            <%- end -%>
          </tr>
        <%- end -%>
      </tbody>
    </table>
    <!--xf:action ev:event="xforms-value-changed">
      <xf:load resource="javascript:update_stockouts()" />
    </xf:action-->

